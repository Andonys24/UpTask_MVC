!function(){!async function(){try{const e="/api/proyectos",r=await fetch(e),n=await r.json();t=n.proyectos,o()}catch(t){console.log(t)}}();let t=[];function e(e=!1,n={}){const c=document.createElement("div");c.classList.add("modal"),c.innerHTML=`\n\t\t<form action="" class="formulario nuevo-proyecto">\n\t\t\t<legend>${e?"Editar Proyecto":"Añade un nuevo proyecto"}</legend>\n\t\t\t<div class="campo">\n\t\t\t\t<label for="proyecto">Proyecto</label>\n\t\t\t\t<input \n\t\t\t\ttype="text" \n\t\t\t\tname="proyecto" \n\t\t\t\tid="proyecto" \n\t\t\t\tplaceholder="${n.proyecto?"Editar Nombre Proyecto":"Añadir nuevo Proyecto"}"  \n\t\t\t\tvalue="${n.proyecto?n.proyecto:""}"/>\n\t\t\t</div>\n\t\t\t<div class="opciones">\n\t\t\t\t<input \n\t\t\t\ttype="submit" \n\t\t\t\tvalue="${n.proyecto?"Guardar Cambios":"Añadir Proyecto"}" \n\t\t\t\tclass="submit-nuevo-proyecto" />\n\t\t\t\t<button \n\t\t\t\ttype="button" \n\t\t\t\tclass="cerrar-modal">${n.proyecto?"Cancelar":"Regresar"}</button>\n\t\t\t</div>\n\t\t</form>\n\t\t`,setTimeout((()=>{document.querySelector(".formulario").classList.add("animar")}),0),c.addEventListener("click",(function(a){if(a.preventDefault(),a.target.classList.contains("cerrar-modal")){document.querySelector(".formulario").classList.add("cerrar"),setTimeout((()=>{c.remove()}),500)}if(a.target.classList.contains("submit-nuevo-proyecto")){const c=document.querySelector("#proyecto").value.trim();if(""===c)return void r("El nombre del proyecto es obligatorio","error",document.querySelector(".formulario legend"));if(c.length>60)return void r("El nombre de el proyecto no puede tener mas de 60 caracteres","error",document.querySelector(".formulario legend"));if(!c.match(/^[a-zA-Z0-9\s\-_.áéíóúÁÉÍÓÚ]+$/))return void r("El nombre del proyecto solo puede contener letras, números, espacios, guiones y guiones bajos","error",document.querySelector(".formulario legend"));if(!e)return void async function(e){const n=new FormData;n.append("proyecto",e);try{const c="/api/proyecto",a=await fetch(c,{method:"POST",body:n}),i=await a.json();if("error"===i.tipo)return void r(i.mensaje,"error",document.querySelector(".formulario legend"));if("exito"===i.tipo){document.querySelector(".cerrar-modal").click(),Swal.fire({position:"top-end",icon:"success",title:i.mensaje,showConfirmButton:!1,timer:1500,customClass:{popup:"swal2-popup",title:"swal2-title",text:"swal2-text"}})}const l={id:String(i.id),proyecto:e,url:i.url,propietarioId:i.propietarioId};t=[...t,l],o()}catch(t){console.log(t)}}(c);n.proyecto=c,async function(e){const{id:r,proyecto:n,propietarioId:c,url:a}=e,i=new FormData;i.append("id",r),i.append("proyecto",n),i.append("propietarioId",c),i.append("url",a);try{const e="/api/proyecto/actualizar",c=await fetch(e,{method:"POST",body:i}),a=await c.json();if(console.log(a),"exito"===a.respuesta.tipo){const t=document.querySelector(".cerrar-modal");t&&t.click(),Swal.fire({position:"top-end",icon:"success",title:a.respuesta.mensaje,showConfirmButton:!1,timer:1500,customClass:{popup:"swal2-popup",title:"swal2-title",text:"swal2-text"}})}t=t.map((t=>(t.id===r&&(t.proyecto=n),t))),o()}catch(t){console.log(t)}}(n)}})),document.querySelector(".dashboard").appendChild(c)}function o(){if(function(){const t=document.querySelector("#listado-proyectos");for(;t.firstChild;)t.removeChild(t.firstChild)}(),0===t.length){const t=document.querySelector("#listado-proyectos"),e=document.createElement("li");return e.textContent="No hay proyectos",e.classList.add("no-proyectos"),void t.appendChild(e)}t.forEach((r=>{const n=document.createElement("li");n.dataset.proyectoId=r.id,n.classList.add("proyecto-api");const c=document.createElement("p");c.textContent=r.proyecto,c.ondblclick=function(){window.location.href=`/proyecto?id=${r.url}`};const a=document.createElement("div");a.classList.add("opciones");const i=document.createElement("button");i.classList.add("editar-proyecto"),i.textContent="Editar",i.dataset.IdProyecto=r.id,i.onclick=function(){e(!0,{...r})};const l=document.createElement("button");l.classList.add("eliminar-proyecto"),l.dataset.IdProyecto=r.id,l.textContent="Eliminar",l.onclick=function(){!function(e){Swal.fire({title:"¿Eliminar Proyecto?",text:"¡No podrás revertir esto, se perdera todo su contenido!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"¡Si, Eliminar!",cancelButtonText:"Cancelar",customClass:{popup:"swal2-popup",title:"swal2-title",text:"swal2-text"}}).then((r=>{r.isConfirmed&&async function(e){const{id:r,propietarioId:n,proyecto:c,url:a}=e,i=new FormData;i.append("id",r),i.append("propietarioId",n),i.append("proyecto",c),i.append("url",a);try{const r="/api/proyecto/eliminar",n=await fetch(r,{method:"POST",body:i});if(401===n.status)return void Swal.fire({icon:"error",title:"Oops...",text:"¡Algo salió mal!"});resultado=await n.json(),console.log(resultado),resultado.resultado&&Swal.fire({position:"top-end",icon:"success",title:resultado.mensaje,showConfirmButton:!1,timer:1500,customClass:{popup:"swal2-popup",title:"swal2-title",text:"swal2-text"}}),t=t.filter((t=>t.id!==e.id)),o()}catch(t){console.log(t)}}(e)}))}(r)},a.appendChild(i),a.appendChild(l),n.appendChild(c),n.appendChild(a);document.querySelector("#listado-proyectos").appendChild(n)}))}function r(t,e,o){const r=document.querySelector(".alerta");r&&r.remove();const n=document.createElement("div");n.classList.add("alerta",e),n.textContent=t,o.parentElement.insertBefore(n,o.nextElementSibling),setTimeout((()=>{n.remove()}),5e3)}document.querySelector("#agregar-proyecto").addEventListener("click",(function(){e()}))}();